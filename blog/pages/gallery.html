<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç›¸å†Œ - â„³à¦æ‰§å¿µê¦¿çš„åšå®¢</title>
    <link rel="stylesheet" href="../css/style.css">
    <link rel="stylesheet" href="../css/search.css">
    <link rel="stylesheet" href="../css/gallery-effects.css">
    <link rel="stylesheet" href="../css/themes.css">
    <link rel="stylesheet" href="../css/theme-adapter.css">
    <link rel="stylesheet" href="../css/modern-nav.css?v=2">
    <link rel="stylesheet" href="../css/video-background.css">
</head>
<body>
    <nav class="modern-nav">
        <div class="nav-left">
            <a href="../index.html" class="nav-logo">
                <img id="siteAvatar" class="logo-avatar" src="https://ui-avatars.com/api/?name=æ‰§å¿µ&size=200&background=4fc3f7&color=fff&bold=true" alt="å¤´åƒ">
                <span class="logo-text">â„³à¦æ‰§å¿µê¦¿çš„åšå®¢</span>
            </a>
        </div>
        <div class="nav-center">
            <div class="nav-indicator"></div>
            <a href="../index.html" class="nav-item"><span class="nav-item-icon">ğŸ </span><span class="nav-item-text">é¦–é¡µ</span></a>
            <a href="tags.html" class="nav-item"><span class="nav-item-icon">ğŸ·ï¸</span><span class="nav-item-text">æ ‡ç­¾</span></a>
            <a href="categories.html" class="nav-item"><span class="nav-item-icon">ğŸ“‚</span><span class="nav-item-text">åˆ†ç±»</span></a>
            <a href="timeline.html" class="nav-item"><span class="nav-item-icon">â°</span><span class="nav-item-text">æ—¶å…‰è½´</span></a>
            <a href="about.html" class="nav-item"><span class="nav-item-icon">ğŸ‘¤</span><span class="nav-item-text">å…³äº</span></a>
            <a href="gallery.html" class="nav-item active"><span class="nav-item-icon">ğŸ–¼ï¸</span><span class="nav-item-text">ç›¸å†Œ</span></a>
            <a href="apps.html" class="nav-item"><span class="nav-item-icon">ğŸ®</span><span class="nav-item-text">åº”ç”¨</span></a>
            <a href="guestbook.html" class="nav-item"><span class="nav-item-icon">ğŸ’¬</span><span class="nav-item-text">ç•™è¨€æ¿</span></a>
            <a href="links.html" class="nav-item"><span class="nav-item-icon">ğŸ”—</span><span class="nav-item-text">å‹é“¾</span></a>
        </div>
        <div class="nav-right">
            <div class="nav-search">
                <span class="search-icon">ğŸ”</span>
                <input type="text" id="searchInput" class="search-input" placeholder="æœç´¢æ–‡ç« ..." onkeypress="handleSearchKeyPress(event)">
            </div>
        </div>
        <button class="mobile-menu-btn" id="mobileMenuBtn"><span></span><span></span><span></span></button>
    </nav>
    <section class="main-content" style="min-height: 100vh; padding-top: 90px;">

        <main class="content-area" style="padding-top: 6rem;">
            <div class="main-content-box">
                <!-- 3D æ—‹è½¬ç›¸å†Œ -->
                <div id="carousel3DContainer"></div>
                
                <h1 style="text-align: center; color: #2c5f7c; margin-bottom: 1rem;">ğŸ“· ç›¸å†Œ</h1>
                <p style="text-align: center; color: #7ba3b8; margin-bottom: 2rem;">
                    å…± <span id="galleryCount">0</span> å¼ ç…§ç‰‡
                </p>
                <div id="galleryGrid" class="gallery-grid">
                    <!-- ç…§ç‰‡å°†é€šè¿‡ JavaScript åŠ¨æ€åŠ è½½ -->
                </div>
            </div>
        </main>

        <!-- å›¾ç‰‡é¢„è§ˆæ¨¡æ€æ¡† -->
        <div id="imageModal" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.9); z-index: 9999; padding: 2rem;">
            <div style="position: relative; height: 100%; display: flex; flex-direction: column; align-items: center; justify-content: center;">
                <button onclick="closeImageModal()" style="position: absolute; top: 1rem; right: 1rem; background: rgba(255,255,255,0.2); color: white; border: none; font-size: 2rem; width: 50px; height: 50px; border-radius: 50%; cursor: pointer; transition: all 0.3s;">Ã—</button>
                <img id="modalImage" src="" alt="" style="max-width: 90%; max-height: 80vh; border-radius: 8px; box-shadow: 0 10px 40px rgba(0,0,0,0.5);">
                <div id="modalInfo" style="margin-top: 1.5rem; text-align: center; color: white; max-width: 600px;">
                    <h3 id="modalTitle" style="font-size: 1.3rem; margin-bottom: 0.5rem;"></h3>
                    <p id="modalDesc" style="font-size: 1rem; color: rgba(255,255,255,0.8);"></p>
                </div>
                <div style="position: absolute; left: 2rem; top: 50%; transform: translateY(-50%);">
                    <button onclick="prevImage()" style="background: rgba(255,255,255,0.2); color: white; border: none; font-size: 2rem; width: 50px; height: 50px; border-radius: 50%; cursor: pointer; transition: all 0.3s;">â€¹</button>
                </div>
                <div style="position: absolute; right: 2rem; top: 50%; transform: translateY(-50%);">
                    <button onclick="nextImage()" style="background: rgba(255,255,255,0.2); color: white; border: none; font-size: 2rem; width: 50px; height: 50px; border-radius: 50%; cursor: pointer; transition: all 0.3s;">â€º</button>
                </div>
            </div>
        </div>

        <footer class="site-footer">
            <div class="footer-stats">
                <div class="stat-item"><span class="stat-icon">ğŸ“</span><div class="stat-info"><span class="stat-value" id="totalWords">0</span><span class="stat-label">æ€»å­—æ•°</span></div></div>
                <div class="stat-item"><span class="stat-icon">ğŸ‘€</span><div class="stat-info"><span class="stat-value" id="totalViews">0</span><span class="stat-label">æ€»è®¿é—®é‡</span></div></div>
                <div class="stat-item"><span class="stat-icon">ğŸ‘¥</span><div class="stat-info"><span class="stat-value" id="totalVisitors">0</span><span class="stat-label">è®¿é—®äººæ•°</span></div></div>
                <div class="stat-item"><span class="stat-icon">â±ï¸</span><div class="stat-info"><span class="stat-value" id="runningTime">0å¤©</span><span class="stat-label">è¿è¡Œæ—¶é•¿</span></div></div>
            </div>
            <div class="footer-copyright"><p>&copy; 2025 â„³à¦æ‰§å¿µê¦¿çš„åšå®¢. All rights reserved.</p></div>
        </footer>
    </section>
    <link rel="stylesheet" href="../css/sakura.css">
    <!-- è·¯å¾„ä¿®å¤å™¨ - å¿…é¡»æœ€å…ˆåŠ è½½ -->
    <script src="../js/path-fixer.js"></script>
    <!-- GitHub Pages é€‚é…å™¨ -->
    <script src="../js/github-pages-adapter.js"></script>
    <!-- ç¯å¢ƒé€‚é…å™¨ - å¿…é¡»åœ¨æ•°æ®é€‚é…å™¨ä¹‹å‰åŠ è½½ -->
    <script src="../js/environment-adapter.js"></script>
    <!-- æ•°æ®é€‚é…å±‚ - æ”¯æŒJSONæ–‡ä»¶å­˜å‚¨ -->
    <script src="../js/data-adapter.js"></script>
    <script src="../js/data-store-wrapper.js"></script>
    <script src="../js/theme-manager.js"></script>
    <script src="../js/search.js"></script>
    <script src="../js/sakura.js"></script>
    <script src="../js/stats-sync.js"></script>
    <script src="../js/gallery-effects.js"></script>
    <script src="../js/main.js"></script>
    <script>
        // ç›¸å†Œæ•°æ®å’Œå½“å‰ç´¢å¼•
        let galleryImages = [];
        let currentImageIndex = 0;

        // æ¸²æŸ“ç›¸å†Œï¼ˆå¼‚æ­¥ï¼‰
        async function renderGallery() {
            if (!window.blogDataStore) {
                setTimeout(renderGallery, 100);
                return;
            }

            galleryImages = await window.blogDataStore.getImages();
            const grid = document.getElementById('galleryGrid');
            const count = document.getElementById('galleryCount');

            if (count) count.textContent = galleryImages.length;

            if (galleryImages.length === 0) {
                grid.innerHTML = `
                    <div style="grid-column: 1/-1; text-align: center; padding: 4rem; color: #999;">
                        <div style="font-size: 4rem; margin-bottom: 1rem;">ğŸ“·</div>
                        <div style="font-size: 1.2rem;">æš‚æ— ç…§ç‰‡</div>
                        <div style="font-size: 0.9rem; margin-top: 0.5rem;">è¯·åœ¨åå°ç®¡ç†ä¸­ä¸Šä¼ å›¾ç‰‡</div>
                    </div>
                `;
                return;
            }

            grid.innerHTML = galleryImages.map((image, index) => `
                <div class="gallery-item" onclick="openImageModal(${index})" style="position: relative; cursor: pointer; border-radius: 12px; overflow: hidden; box-shadow: 0 2px 10px rgba(0,0,0,0.1); transition: all 0.3s;">
                    <img src="${image.thumbnail || image.url}" alt="${image.name}" style="width: 100%; height: 280px; object-fit: cover; display: block;">
                    <div style="position: absolute; bottom: 0; left: 0; right: 0; background: linear-gradient(to top, rgba(0,0,0,0.7), transparent); padding: 1.5rem 1rem 1rem; color: white;">
                        <div style="font-size: 0.95rem; font-weight: 500; margin-bottom: 0.3rem; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">${image.name}</div>
                        ${image.description ? `<div style="font-size: 0.85rem; opacity: 0.9; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">${image.description}</div>` : ''}
                    </div>
                </div>
            `).join('');

            // æ·»åŠ æ‚¬åœæ•ˆæœ
            document.querySelectorAll('.gallery-item').forEach(item => {
                item.addEventListener('mouseenter', function() {
                    this.style.transform = 'translateY(-5px)';
                    this.style.boxShadow = '0 8px 25px rgba(0,0,0,0.15)';
                });
                item.addEventListener('mouseleave', function() {
                    this.style.transform = 'translateY(0)';
                    this.style.boxShadow = '0 2px 10px rgba(0,0,0,0.1)';
                });
            });
        }

        // æ‰“å¼€å›¾ç‰‡é¢„è§ˆ
        function openImageModal(index) {
            currentImageIndex = index;
            showCurrentImage();
            document.getElementById('imageModal').style.display = 'block';
            document.body.style.overflow = 'hidden';
        }

        // å…³é—­å›¾ç‰‡é¢„è§ˆ
        function closeImageModal() {
            document.getElementById('imageModal').style.display = 'none';
            document.body.style.overflow = 'auto';
        }

        // æ˜¾ç¤ºå½“å‰å›¾ç‰‡
        function showCurrentImage() {
            const image = galleryImages[currentImageIndex];
            if (!image) return;

            document.getElementById('modalImage').src = image.url;
            document.getElementById('modalTitle').textContent = image.name;
            document.getElementById('modalDesc').textContent = image.description || 'æš‚æ— æè¿°';
        }

        // ä¸Šä¸€å¼ 
        function prevImage() {
            currentImageIndex = (currentImageIndex - 1 + galleryImages.length) % galleryImages.length;
            showCurrentImage();
        }

        // ä¸‹ä¸€å¼ 
        function nextImage() {
            currentImageIndex = (currentImageIndex + 1) % galleryImages.length;
            showCurrentImage();
        }

        // é”®ç›˜å¯¼èˆª
        document.addEventListener('keydown', function(e) {
            const modal = document.getElementById('imageModal');
            if (modal.style.display === 'block') {
                if (e.key === 'Escape') closeImageModal();
                else if (e.key === 'ArrowLeft') prevImage();
                else if (e.key === 'ArrowRight') nextImage();
            }
        });

        // ç‚¹å‡»èƒŒæ™¯å…³é—­
        document.getElementById('imageModal')?.addEventListener('click', function(e) {
            if (e.target === this) closeImageModal();
        });

        // é¡µé¢åŠ è½½æ—¶æ¸²æŸ“
        document.addEventListener('DOMContentLoaded', async () => {
            console.log('ğŸ“„ é¡µé¢åŠ è½½å®Œæˆï¼Œå¼€å§‹åˆå§‹åŒ–...');
            
            // å…ˆæ¸²æŸ“ç›¸å†Œ
            await renderGallery();
            console.log('âœ… ç›¸å†Œç½‘æ ¼æ¸²æŸ“å®Œæˆ');
            
            // ç­‰å¾…galleryEffectsåˆå§‹åŒ–å®Œæˆ
            async function waitForGalleryEffects() {
                if (!window.galleryEffects) {
                    console.log('â³ ç­‰å¾… galleryEffects...');
                    await new Promise(resolve => setTimeout(resolve, 100));
                    return waitForGalleryEffects();
                }
                
                // ç­‰å¾…åˆå§‹åŒ–å®Œæˆ
                if (!window.galleryEffects.initialized) {
                    console.log('â³ ç­‰å¾… galleryEffects åˆå§‹åŒ–...');
                    await new Promise(resolve => setTimeout(resolve, 100));
                    return waitForGalleryEffects();
                }
                
                console.log('âœ… GalleryEffectså·²å°±ç»ª');
                console.log('ğŸ“Š å›¾ç‰‡æ•°é‡:', window.galleryEffects.images.length);
                
                // å¦‚æœå›¾ç‰‡æ•°æ®ä¸ºç©ºï¼Œé‡æ–°åŠ è½½
                if (window.galleryEffects.images.length === 0) {
                    console.log('âš ï¸ å›¾ç‰‡æ•°æ®ä¸ºç©ºï¼Œé‡æ–°åŠ è½½...');
                    await window.galleryEffects.loadImages();
                    console.log('ğŸ“Š é‡æ–°åŠ è½½åå›¾ç‰‡æ•°é‡:', window.galleryEffects.images.length);
                }
                
                // æ¸²æŸ“3Dæ—‹è½¬ç›¸å†Œ
                console.log('ğŸ¨ å¼€å§‹æ¸²æŸ“3Dæ—‹è½¬ç›¸å†Œ...');
                window.galleryEffects.render3DCarousel();
                
                // å†å»¶è¿Ÿåº”ç”¨ç‰¹æ•ˆï¼Œç¡®ä¿å›¾ç‰‡å·²ç»æ¸²æŸ“
                setTimeout(() => {
                    console.log('ğŸ¨ åº”ç”¨ç›¸å†Œç‰¹æ•ˆ...');
                    window.galleryEffects.applyEffect();
                }, 100);
            }
            
            // å»¶è¿Ÿæ‰§è¡Œï¼Œç¡®ä¿DOMå·²æ¸²æŸ“
            setTimeout(() => waitForGalleryEffects(), 300);
        });
    </script>
    <!-- è§†é¢‘èƒŒæ™¯ -->
    <script src="../js/video-background.js"></script>
</body>
</html>



    <script src="../js/modern-nav.js"></script>
    <script src="../js/video-background.js"></script>
</body>
</html>
