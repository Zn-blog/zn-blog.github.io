<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç®€å†ç”Ÿæˆå™¨è°ƒè¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #f5f5f5;
        }
        .debug-panel {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .error {
            color: red;
            background: #ffe6e6;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
        .success {
            color: green;
            background: #e6ffe6;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
        .test-form {
            margin: 20px 0;
        }
        .test-form input {
            padding: 8px;
            margin: 5px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        .test-form button {
            padding: 8px 16px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        #preview {
            border: 1px solid #ddd;
            padding: 20px;
            background: white;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <h1>ç®€å†ç”Ÿæˆå™¨è°ƒè¯•é¡µé¢</h1>
    
    <div class="debug-panel">
        <h2>è„šæœ¬åŠ è½½çŠ¶æ€</h2>
        <div id="scriptStatus"></div>
    </div>
    
    <div class="debug-panel">
        <h2>æµ‹è¯•è¡¨å•</h2>
        <div class="test-form">
            <input type="text" id="testName" placeholder="å§“å" value="å¼ ä¸‰">
            <input type="text" id="testPhone" placeholder="ç”µè¯" value="13800138000">
            <input type="email" id="testEmail" placeholder="é‚®ç®±" value="zhangsan@example.com">
            <input type="text" id="testPosition" placeholder="èŒä½" value="å‰ç«¯å·¥ç¨‹å¸ˆ">
            <button onclick="testPreview()">æµ‹è¯•é¢„è§ˆ</button>
        </div>
    </div>
    
    <div class="debug-panel">
        <h2>é¢„è§ˆåŒºåŸŸ</h2>
        <div id="preview">
            <div class="preview-placeholder">
                <div>ğŸ“„</div>
                <p>è¯·å¡«å†™åŸºæœ¬ä¿¡æ¯ä»¥æŸ¥çœ‹ç®€å†é¢„è§ˆ</p>
            </div>
        </div>
    </div>

    <!-- å¼•å…¥ç¬¬ä¸‰æ–¹åº“ -->
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
    
    <!-- å¼•å…¥åº”ç”¨è„šæœ¬ -->
    <script src="js/utils.js"></script>
    <script src="js/form-handler.js"></script>
    <script src="js/template-engine.js"></script>
    <script src="js/export-manager.js"></script>
    
    <script>
        // æ£€æŸ¥è„šæœ¬åŠ è½½çŠ¶æ€
        function checkScriptStatus() {
            const statusDiv = document.getElementById('scriptStatus');
            let status = '';
            
            // æ£€æŸ¥å„ä¸ªç±»æ˜¯å¦å·²å®šä¹‰
            const checks = [
                { name: 'ResumeUtils', obj: window.ResumeUtils },
                { name: 'FormHandler', obj: window.FormHandler },
                { name: 'TemplateEngine', obj: window.TemplateEngine },
                { name: 'ExportManager', obj: window.ExportManager },
                { name: 'XLSX', obj: window.XLSX },
                { name: 'jsPDF', obj: window.jspdf },
                { name: 'html2canvas', obj: window.html2canvas }
            ];
            
            checks.forEach(check => {
                if (check.obj) {
                    status += `<div class="success">âœ… ${check.name} å·²åŠ è½½</div>`;
                } else {
                    status += `<div class="error">âŒ ${check.name} æœªåŠ è½½</div>`;
                }
            });
            
            statusDiv.innerHTML = status;
        }
        
        // æµ‹è¯•é¢„è§ˆåŠŸèƒ½
        function testPreview() {
            try {
                console.log('å¼€å§‹æµ‹è¯•é¢„è§ˆåŠŸèƒ½...');
                
                // æ£€æŸ¥å¿…è¦çš„ç±»æ˜¯å¦å­˜åœ¨
                if (!window.TemplateEngine) {
                    throw new Error('TemplateEngine æœªåŠ è½½');
                }
                
                // åˆ›å»ºæ¨¡æ¿å¼•æ“å®ä¾‹
                const templateEngine = new TemplateEngine();
                console.log('TemplateEngine å®ä¾‹åˆ›å»ºæˆåŠŸ');
                
                // è·å–æµ‹è¯•æ•°æ®
                const testData = {
                    personal: {
                        name: document.getElementById('testName').value,
                        phone: document.getElementById('testPhone').value,
                        email: document.getElementById('testEmail').value,
                        position: document.getElementById('testPosition').value,
                        age: '',
                        gender: '',
                        address: ''
                    },
                    education: [],
                    experience: [],
                    projects: [],
                    skills: 'JavaScript, HTML, CSS, React',
                    evaluation: 'è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•çš„è‡ªæˆ‘è¯„ä»·å†…å®¹ã€‚',
                    meta: {
                        template: 'classic',
                        createdAt: new Date().toISOString(),
                        updatedAt: new Date().toISOString()
                    }
                };
                
                console.log('æµ‹è¯•æ•°æ®:', testData);
                
                // æ¸²æŸ“é¢„è§ˆ
                templateEngine.render(testData);
                console.log('é¢„è§ˆæ¸²æŸ“å®Œæˆ');
                
                // å°†é¢„è§ˆå†…å®¹å¤åˆ¶åˆ°è°ƒè¯•é¡µé¢
                const resumePreview = document.getElementById('resumePreview');
                const debugPreview = document.getElementById('preview');
                
                if (resumePreview && debugPreview) {
                    debugPreview.innerHTML = resumePreview.innerHTML;
                    console.log('é¢„è§ˆå†…å®¹å·²å¤åˆ¶åˆ°è°ƒè¯•é¡µé¢');
                } else {
                    console.log('é¢„è§ˆå…ƒç´ æœªæ‰¾åˆ°ï¼Œç›´æ¥åœ¨è°ƒè¯•é¡µé¢ç”Ÿæˆ');
                    const html = templateEngine.classicTemplate(testData);
                    debugPreview.innerHTML = html;
                }
                
                ResumeUtils.showMessage('é¢„è§ˆæµ‹è¯•æˆåŠŸï¼', 'success');
                
            } catch (error) {
                console.error('é¢„è§ˆæµ‹è¯•å¤±è´¥:', error);
                ResumeUtils.showMessage(`é¢„è§ˆæµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
            }
        }
        
        // é¡µé¢åŠ è½½å®Œæˆåæ£€æŸ¥çŠ¶æ€
        window.addEventListener('load', () => {
            setTimeout(checkScriptStatus, 1000);
        });
        
        // ç›‘å¬é”™è¯¯
        window.addEventListener('error', (e) => {
            console.error('JavaScripté”™è¯¯:', e.error);
            const statusDiv = document.getElementById('scriptStatus');
            statusDiv.innerHTML += `<div class="error">âŒ JavaScripté”™è¯¯: ${e.message}</div>`;
        });
    </script>
</body>
</html>