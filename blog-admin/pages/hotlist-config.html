<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>çƒ­æ¦œAPIé…ç½® - åå°ç®¡ç†</title>
    <link rel="stylesheet" href="../css/admin.css">
    <link rel="stylesheet" href="../css/admin-theme-adapter.css">
    <link rel="stylesheet" href="../../blog/css/themes.css">
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 2rem;
        }

        .config-container {
            max-width: 1400px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.98);
            border-radius: 20px;
            padding: 3rem;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        .config-header {
            text-align: center;
            margin-bottom: 3rem;
            padding-bottom: 2rem;
            border-bottom: 3px solid #f0f0f0;
        }

        .config-header h1 {
            font-size: 2.5rem;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 0.5rem;
        }

        .config-header p {
            color: #666;
            font-size: 1.1rem;
        }

        .config-actions {
            display: flex;
            gap: 1rem;
            justify-content: center;
            margin-top: 1.5rem;
        }

        .config-grid {
            display: grid;
            gap: 2rem;
        }

        .config-card {
            background: #fff;
            border-radius: 16px;
            padding: 2rem;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            border: 2px solid #f0f0f0;
            transition: all 0.3s;
        }

        .config-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 30px rgba(102, 126, 234, 0.15);
            border-color: #667eea;
        }

        .config-card-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 2rem;
            padding-bottom: 1.5rem;
            border-bottom: 2px solid #f8f9fa;
        }

        .config-card-icon {
            font-size: 2.5rem;
            width: 60px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }

        .config-card-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: #333;
        }

        .config-form-group {
            margin-bottom: 1.5rem;
        }

        .config-form-group label {
            display: block;
            margin-bottom: 0.75rem;
            font-weight: 600;
            color: #555;
            font-size: 0.95rem;
        }

        .config-form-group input,
        .config-form-group select {
            width: 100%;
            padding: 0.875rem 1rem;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 0.95rem;
            transition: all 0.3s;
            background: #fafafa;
        }

        .config-form-group input:focus,
        .config-form-group select:focus {
            outline: none;
            border-color: #667eea;
            background: white;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .config-form-group small {
            display: block;
            margin-top: 0.5rem;
            color: #888;
            font-size: 0.85rem;
        }

        .btn {
            padding: 0.875rem 1.75rem;
            border: none;
            border-radius: 8px;
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: #f8f9fa;
            color: #555;
            border: 2px solid #e0e0e0;
        }

        .btn-secondary:hover {
            background: #e9ecef;
            border-color: #667eea;
            color: #667eea;
        }

        .btn-test {
            background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
            color: white;
            box-shadow: 0 4px 12px rgba(76, 175, 80, 0.3);
        }

        .btn-test:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(76, 175, 80, 0.4);
        }

        .test-result {
            margin-top: 1.5rem;
            padding: 1.25rem;
            border-radius: 10px;
            display: none;
            font-size: 0.9rem;
            line-height: 1.6;
        }

        .test-result.success {
            background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);
            color: #155724;
            border: 2px solid #b1dfbb;
        }

        .test-result.error {
            background: linear-gradient(135deg, #f8d7da 0%, #f5c6cb 100%);
            color: #721c24;
            border: 2px solid #f1b0b7;
        }

        .back-link {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            color: white;
            text-decoration: none;
            margin-bottom: 1.5rem;
            padding: 0.75rem 1.5rem;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            backdrop-filter: blur(10px);
            transition: all 0.3s;
        }

        .back-link:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateX(-4px);
        }

        .button-group {
            display: flex;
            gap: 1rem;
            margin-top: 2rem;
        }

        .button-group .btn {
            flex: 1;
        }
    </style>
</head>
<body>
    <a href="../index.html" class="back-link">â† è¿”å›åå°é¦–é¡µ</a>
    
    <div class="config-container">
        <div class="config-header">
            <h1>ğŸ”¥ çƒ­æ¦œAPIé…ç½®ä¸­å¿ƒ</h1>
            <p>é…ç½®ä¸åŒå¹³å°çš„çƒ­æœAPIæ¥å£ï¼Œè‡ªå®šä¹‰æ•°æ®æº</p>
            <div class="config-actions">
                <button class="btn btn-secondary" onclick="resetAllConfig()">ğŸ”„ é‡ç½®ä¸ºé»˜è®¤</button>
                <button class="btn btn-primary" onclick="saveAllConfig()">ğŸ’¾ ä¿å­˜æ‰€æœ‰é…ç½®</button>
            </div>
        </div>

        <div class="config-grid" id="configGrid">
            <!-- é…ç½®å¡ç‰‡å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
        </div>
    </div>

    <script src="../hotlist-api-config.js"></script>
    <script>
        // åŠ è½½é…ç½®
        let currentConfig = loadHotlistConfig();

        // æ¸²æŸ“é…ç½®è¡¨å•
        function renderConfigForms() {
            const grid = document.getElementById('configGrid');
            grid.innerHTML = '';

            Object.keys(currentConfig).forEach(key => {
                const config = currentConfig[key];
                const card = document.createElement('div');
                card.className = 'config-card';
                card.innerHTML = `
                    <div class="config-card-header">
                        <div class="config-card-icon">${config.icon}</div>
                        <h2 class="config-card-title">${config.name}çƒ­æœé…ç½®</h2>
                    </div>

                    <div class="config-form-group">
                        <label>ğŸ“¡ APIåœ°å€</label>
                        <input type="url" 
                               id="${key}-apiUrl" 
                               value="${config.apiUrl}"
                               placeholder="https://api.example.com/hotlist">
                        <small>ğŸ’¡ çƒ­æœæ•°æ®çš„APIæ¥å£åœ°å€</small>
                    </div>

                    <div class="config-form-group">
                        <label>ğŸ”§ è¯·æ±‚æ–¹æ³•</label>
                        <select id="${key}-method">
                            <option value="GET" ${config.method === 'GET' ? 'selected' : ''}>GET</option>
                            <option value="POST" ${config.method === 'POST' ? 'selected' : ''}>POST</option>
                        </select>
                    </div>

                    <div class="config-form-group">
                        <label>ğŸ“‚ æ•°æ®è·¯å¾„</label>
                        <input type="text" 
                               id="${key}-dataPath" 
                               value="${config.responseParser.dataPath}"
                               placeholder="data">
                        <small>ğŸ’¡ å“åº”æ•°æ®ä¸­çƒ­æœåˆ—è¡¨çš„å­—æ®µåï¼ˆå¦‚ï¼šdataã€listç­‰ï¼‰</small>
                    </div>

                    <div class="button-group">
                        <button class="btn btn-test" onclick="testAPI('${key}')">ğŸ§ª æµ‹è¯•API</button>
                        <button class="btn btn-primary" onclick="saveConfig('${key}')">ğŸ’¾ ä¿å­˜é…ç½®</button>
                    </div>

                    <div class="test-result" id="${key}-result"></div>
                `;
                grid.appendChild(card);
            });
        }

        // æµ‹è¯•API
        async function testAPI(key) {
            const resultDiv = document.getElementById(`${key}-result`);
            resultDiv.style.display = 'block';
            resultDiv.className = 'test-result';
            resultDiv.textContent = 'æµ‹è¯•ä¸­...';

            const apiUrl = document.getElementById(`${key}-apiUrl`).value;
            
            try {
                const response = await fetch(apiUrl);
                const data = await response.json();
                
                resultDiv.className = 'test-result success';
                resultDiv.innerHTML = `
                    <strong>âœ“ APIæµ‹è¯•æˆåŠŸ</strong><br>
                    çŠ¶æ€ç : ${response.status}<br>
                    è¿”å›æ•°æ®: ${JSON.stringify(data).substring(0, 200)}...
                `;
            } catch (error) {
                resultDiv.className = 'test-result error';
                resultDiv.innerHTML = `
                    <strong>âœ— APIæµ‹è¯•å¤±è´¥</strong><br>
                    é”™è¯¯ä¿¡æ¯: ${error.message}
                `;
            }
        }

        // ä¿å­˜å•ä¸ªé…ç½®
        function saveConfig(key) {
            const apiUrl = document.getElementById(`${key}-apiUrl`).value;
            const method = document.getElementById(`${key}-method`).value;
            const dataPath = document.getElementById(`${key}-dataPath`).value;

            currentConfig[key].apiUrl = apiUrl;
            currentConfig[key].method = method;
            currentConfig[key].responseParser.dataPath = dataPath;

            if (saveHotlistConfig(currentConfig)) {
                alert(`${currentConfig[key].name}çƒ­æœé…ç½®å·²ä¿å­˜ï¼`);
            } else {
                alert('ä¿å­˜å¤±è´¥ï¼Œè¯·é‡è¯•');
            }
        }

        // ä¿å­˜æ‰€æœ‰é…ç½®
        function saveAllConfig() {
            Object.keys(currentConfig).forEach(key => {
                const apiUrl = document.getElementById(`${key}-apiUrl`).value;
                const method = document.getElementById(`${key}-method`).value;
                const dataPath = document.getElementById(`${key}-dataPath`).value;

                currentConfig[key].apiUrl = apiUrl;
                currentConfig[key].method = method;
                currentConfig[key].responseParser.dataPath = dataPath;
            });

            if (saveHotlistConfig(currentConfig)) {
                alert('æ‰€æœ‰é…ç½®å·²ä¿å­˜ï¼');
            } else {
                alert('ä¿å­˜å¤±è´¥ï¼Œè¯·é‡è¯•');
            }
        }

        // é‡ç½®æ‰€æœ‰é…ç½®
        function resetAllConfig() {
            if (confirm('ç¡®å®šè¦é‡ç½®ä¸ºé»˜è®¤é…ç½®å—ï¼Ÿ')) {
                currentConfig = resetHotlistConfig();
                renderConfigForms();
                alert('å·²é‡ç½®ä¸ºé»˜è®¤é…ç½®ï¼');
            }
        }

        // åˆå§‹åŒ–
        renderConfigForms();
    </script>
</body>
</html>
